<!doctype html>
<html lang="es" class="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
  <title>POS POSADA</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { darkMode: 'class' };
    function toggleTheme() {
        document.documentElement.classList.toggle('dark');
        const icon = document.getElementById('themeIcon');
        icon.textContent = document.documentElement.classList.contains('dark') ? 'light_mode' : 'dark_mode';
    }
  </script>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
  <style>
    .tap-highlight-transparent { -webkit-tap-highlight-color: transparent; }
    @keyframes pop { 0% { transform: scale(1); } 50% { transform: scale(0.95); } 100% { transform: scale(1); } }
    .btn-pop:active { animation: pop 0.1s ease-in-out; }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .h-dvh { height: 100vh; height: 100dvh; }
  </style>
</head>
<body class="bg-orange-50 dark:bg-zinc-950 text-amber-950 dark:text-zinc-50 font-sans overflow-hidden transition-colors duration-300">

  <button onclick="toggleTheme()" class="fixed top-4 right-4 z-[70] bg-white dark:bg-zinc-800 text-amber-600 dark:text-zinc-400 p-2 rounded-full shadow-lg border border-amber-200 dark:border-zinc-700">
    <span class="material-icons-round" id="themeIcon">light_mode</span>
  </button>

  <div id="registerModal" class="fixed inset-0 z-[60] bg-orange-50 dark:bg-zinc-950 flex flex-col items-center justify-center p-6 hidden">
    <div class="bg-white dark:bg-zinc-900 p-8 rounded-3xl shadow-2xl border-4 border-amber-900/10 dark:border-zinc-800 max-w-md w-full text-center">
        <h1 class="text-3xl font-black text-teal-600 dark:text-emerald-400 mb-2">POSADA 2025</h1>
        <p class="text-amber-800 dark:text-zinc-400 mb-6 font-medium">¿Qué dispositivo es este?</p>
        <div id="registerList" class="grid grid-cols-1 gap-3"></div>
    </div>
  </div>

  <div id="app" class="w-full h-dvh flex flex-col md:flex-row hidden relative">
    <main id="tabMenu" class="w-full md:flex-1 flex flex-col h-full relative md:border-r border-amber-200 dark:border-zinc-800 bg-orange-50 dark:bg-zinc-950 transition-colors">
      <header class="p-3 bg-teal-600 dark:bg-zinc-900 border-b border-teal-700 dark:border-zinc-800 flex flex-col gap-3 shrink-0 shadow-md">
        <div class="flex justify-between items-center w-full">
            <div>
                <h1 class="text-lg font-bold text-white leading-none flex items-center gap-2">
                    El Sembrador 
                    <span id="regBadge" class="text-[10px] bg-teal-800/30 dark:bg-zinc-800 border border-white/30 px-1.5 rounded uppercase font-normal"></span>
                    <button onclick="resetRegisterId()" class="text-teal-200 hover:text-white" title="Cambiar Caja">
                        <span class="material-icons-round text-sm">logout</span>
                    </button>
                </h1>
                <div id="shiftInfo" class="text-[10px] text-teal-100 dark:text-emerald-400 uppercase tracking-wider font-bold mt-0.5">Cargando...</div>
            </div>
            <div class="flex gap-2 mr-10">
               <a href="/admin.html" class="bg-white/10 text-white w-10 h-10 rounded-xl flex items-center justify-center border border-white/20"><span class="material-icons-round text-sm">dashboard</span></a>
               <button onclick="addPaseRapido()" class="bg-white dark:bg-emerald-500 text-teal-700 dark:text-zinc-950 px-3 py-2 rounded-xl font-bold text-xs shadow-lg btn-pop flex items-center gap-1"><span class="material-icons-round text-sm">confirmation_number</span> PASE</button>
               <button id="closeShiftBtn" class="bg-rose-500 text-white px-3 py-2 rounded-xl font-bold text-xs flex items-center gap-1 btn-pop shadow-md border-b-4 border-rose-700"><span class="material-icons-round text-sm">inventory</span> CORTE</button>
            </div>
        </div>
        
        <div class="relative w-full">
            <span class="absolute left-3 top-1/2 -translate-y-1/2 text-teal-200 dark:text-zinc-500 material-icons-round text-lg">search</span>
            <input type="text" id="searchInput" oninput="filter()" placeholder="Buscar producto..." class="w-full bg-teal-700/50 dark:bg-zinc-800 text-white dark:text-white placeholder-teal-200 dark:placeholder-zinc-600 rounded-xl pl-10 pr-4 py-2 text-sm outline-none focus:ring-2 ring-white/20">
        </div>
      </header>

      <div class="px-4 py-3 flex gap-2 overflow-x-auto no-scrollbar bg-amber-50 dark:bg-zinc-950 border-b border-amber-200 dark:border-zinc-800 shrink-0">
        <button onclick="setCategory('Todo')" class="cat-btn px-4 py-2 rounded-full bg-teal-600 dark:bg-emerald-500 text-white dark:text-zinc-950 font-bold text-xs whitespace-nowrap shadow-md">Todo</button>
        <button onclick="setCategory('Comida')" class="cat-btn px-4 py-2 rounded-full bg-white dark:bg-zinc-800 border border-amber-200 dark:border-zinc-700 text-amber-900 dark:text-zinc-300 text-xs whitespace-nowrap font-bold">Comida</button>
        <button onclick="setCategory('Antojitos')" class="cat-btn px-4 py-2 rounded-full bg-white dark:bg-zinc-800 border border-amber-200 dark:border-zinc-700 text-amber-900 dark:text-zinc-300 text-xs whitespace-nowrap font-bold">Antojitos</button>
        <button onclick="setCategory('Bebidas')" class="cat-btn px-4 py-2 rounded-full bg-white dark:bg-zinc-800 border border-amber-200 dark:border-zinc-700 text-amber-900 dark:text-zinc-300 text-xs whitespace-nowrap font-bold">Bebidas</button>
        <button onclick="setCategory('Postres')" class="cat-btn px-4 py-2 rounded-full bg-white dark:bg-zinc-800 border border-amber-200 dark:border-zinc-700 text-amber-900 dark:text-zinc-300 text-xs whitespace-nowrap font-bold">Postres</button>
        <button onclick="setCategory('Otros')" class="cat-btn px-4 py-2 rounded-full bg-white dark:bg-zinc-800 border border-amber-200 dark:border-zinc-700 text-amber-900 dark:text-zinc-300 text-xs whitespace-nowrap font-bold">Otros</button>
      </div>

      <div id="productsGrid" class="flex-1 overflow-y-auto p-3 grid grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-2 content-start pb-20 md:pb-4"></div>
    </main>

    <aside id="tabTicket" class="hidden md:flex w-full md:w-[380px] lg:w-[420px] bg-white dark:bg-zinc-900 flex-col h-full shadow-2xl z-20 border-t md:border-t-0 border-amber-200 dark:border-zinc-800 absolute md:relative inset-0 md:inset-auto">
      <div class="md:hidden p-3 border-b border-amber-100 dark:border-zinc-800 flex items-center gap-3 bg-teal-600 dark:bg-zinc-900">
          <button onclick="switchTab('menu')" class="p-2 rounded-lg bg-white/20 text-white"><span class="material-icons-round">arrow_back</span></button>
          <span class="font-bold text-white">Cuenta</span>
      </div>

      <div class="flex-1 overflow-y-auto flex flex-col bg-white dark:bg-zinc-900/50">
        <div class="hidden md:block p-3 text-xs font-bold text-amber-500 dark:text-zinc-500 uppercase tracking-widest border-b border-amber-100 dark:border-zinc-800 sticky top-0 bg-white/95 dark:bg-zinc-900/95 backdrop-blur z-10 text-center">Orden Actual</div>
        <div id="ticketList" class="p-3 space-y-2 pb-4"></div>
      </div>

      <div class="bg-amber-50 dark:bg-zinc-950 border-t border-amber-200 dark:border-zinc-800 p-2 shrink-0">
        <div class="text-[10px] text-amber-600 dark:text-zinc-500 font-bold uppercase mb-1 px-1">Últimas ventas</div>
        <div id="recentHistory" class="space-y-1"></div>
      </div>

      <div class="bg-white dark:bg-zinc-900 p-4 border-t border-amber-200 dark:border-zinc-800 space-y-3 shadow-inner z-30 relative shrink-0 pb-24 md:pb-4">
        <div class="flex justify-between items-end">
          <div class="text-amber-400 dark:text-zinc-500 text-xs font-bold uppercase mb-1">Total</div>
          <div id="totalDisplay" class="text-5xl font-black text-amber-900 dark:text-white tracking-tighter leading-none">$0.00</div>
        </div>
        <div class="space-y-2">
          <div class="relative group">
            <span class="absolute left-4 top-1/2 -translate-y-1/2 text-amber-400 dark:text-zinc-500 text-xl font-bold">$</span>
            <input id="cashInput" type="number" inputmode="decimal" placeholder="0" class="w-full bg-amber-50 dark:bg-zinc-950 border-2 border-amber-200 dark:border-zinc-700 rounded-2xl pl-10 pr-4 py-3 text-3xl font-bold text-amber-900 dark:text-white outline-none focus:border-teal-500 text-right">
          </div>
          <div id="smartCashButtons" class="grid grid-cols-4 gap-2 h-10 empty:hidden"></div>
        </div>
        
        <div id="changePanel" class="hidden absolute inset-0 bg-teal-700/95 dark:bg-zinc-950/95 backdrop-blur-md z-50 flex flex-col items-center justify-center text-center p-6 animate-fade-in text-white">
             <div class="text-teal-200 font-bold text-xl uppercase mb-2">Entregar Cambio</div>
             <div id="bigChangeDisplay" class="text-7xl font-black text-white mb-8">$0.00</div>
             <button onclick="resetOrder()" class="bg-yellow-400 text-amber-900 px-8 py-4 rounded-xl font-bold text-lg border-b-4 border-yellow-600 w-full shadow-xl">Siguiente</button>
        </div>

        <div class="grid grid-cols-4 gap-2 pt-1">
          <button id="cancelBtn" class="col-span-1 py-4 rounded-xl bg-gray-100 dark:bg-zinc-800 border border-gray-200 dark:border-zinc-700 text-gray-400 font-bold hover:bg-rose-100 dark:hover:bg-rose-900/30 hover:text-rose-500 btn-pop"><span class="material-icons-round">delete</span></button>
          <button id="payBtn" class="col-span-3 py-4 rounded-xl bg-yellow-400 dark:bg-emerald-500 text-amber-900 dark:text-zinc-950 font-black text-2xl shadow-lg btn-pop disabled:opacity-50 border-b-4 border-yellow-600 dark:border-emerald-700">COBRAR</button>
        </div>
      </div>
    </aside>

    <nav class="md:hidden fixed bottom-0 inset-x-0 bg-white dark:bg-zinc-900 border-t border-amber-100 dark:border-zinc-800 flex justify-around p-2 z-50 pb-safe shadow-lg">
        <button onclick="switchTab('menu')" id="btnTabMenu" class="flex-1 flex flex-col items-center justify-center p-2 rounded-xl text-teal-600 bg-teal-50"><span class="material-icons-round">restaurant_menu</span><span class="text-[10px] font-bold mt-1">MENÚ</span></button>
        <button onclick="switchTab('ticket')" id="btnTabTicket" class="flex-1 flex flex-col items-center justify-center p-2 rounded-xl text-amber-300 relative"><span class="material-icons-round">receipt_long</span><span class="text-[10px] font-bold mt-1">CUENTA</span><div id="cartBadge" class="hidden absolute top-2 right-10 bg-rose-500 text-white text-[10px] font-bold w-5 h-5 rounded-full flex items-center justify-center">0</div></button>
    </nav>
  </div>

  <dialog id="cutModal" class="bg-white dark:bg-zinc-900 text-amber-900 dark:text-white rounded-3xl p-0 backdrop:bg-black/50 w-full max-w-md shadow-2xl border-4 border-amber-900/10 dark:border-zinc-700 m-4">
    <div class="p-6">
        <h2 class="text-2xl font-black mb-4">Corte de Caja</h2>
        <div class="space-y-4 text-sm">
            <div class="flex justify-between p-3 bg-amber-50 dark:bg-zinc-950 border border-amber-100 dark:border-zinc-800 rounded-xl"><span class="text-amber-500">Fondo Inicial</span><span id="cutOpening" class="font-bold font-mono text-lg">$0.00</span></div>
            <div class="flex justify-between p-3 bg-amber-50 dark:bg-zinc-950 border border-amber-100 dark:border-zinc-800 rounded-xl"><span class="text-teal-600 dark:text-emerald-400 font-bold">+ Ventas</span><span id="cutSales" class="font-bold font-mono text-lg text-teal-600 dark:text-emerald-400">$0.00</span></div>
            <div class="flex justify-between items-center p-4 bg-teal-50 dark:bg-emerald-900/20 border-2 border-teal-100 dark:border-emerald-500/30 rounded-xl"><span class="text-teal-700 dark:text-emerald-400 uppercase font-black text-xs">Total en Cajón</span><span id="cutTotal" class="font-black text-3xl text-teal-700 dark:text-emerald-400">$0.00</span></div>
        </div>
        <div class="grid grid-cols-2 gap-3 mt-8">
            <button onclick="document.getElementById('cutModal').close()" class="py-3 rounded-xl bg-gray-100 dark:bg-zinc-800 font-bold text-gray-500">Volver</button>
            <button onclick="confirmCloseShift()" class="py-3 rounded-xl bg-rose-500 hover:bg-rose-600 font-bold text-white shadow-lg border-b-4 border-rose-700">Cerrar</button>
        </div>
    </div>
  </dialog>

  <script>
    let PRODUCTS=[], cart={}, currentOrder=null, currentShift=null;
    let registerId = localStorage.getItem('pos_register_id');
    let currentCategory = 'Todo';
    const qs=(s)=>document.querySelector(s);
    const money=(c)=>(c/100).toLocaleString('es-MX',{style:'currency',currency:'MXN'});
    
    function switchTab(t){
        const m=qs("#tabMenu"), k=qs("#tabTicket"), bm=qs("#btnTabMenu"), bk=qs("#btnTabTicket");
        if(t==='menu'){ m.classList.remove("hidden"); k.classList.add("hidden"); k.classList.remove("flex"); bm.className="flex-1 flex flex-col items-center justify-center p-2 rounded-xl text-teal-600 bg-teal-50 dark:bg-zinc-800 dark:text-emerald-400"; bk.className="flex-1 flex flex-col items-center justify-center p-2 rounded-xl text-amber-300 relative"; }
        else { m.classList.add("hidden"); k.classList.remove("hidden"); k.classList.add("flex"); bk.className="flex-1 flex flex-col items-center justify-center p-2 rounded-xl text-teal-600 bg-teal-50 dark:bg-zinc-800 dark:text-emerald-400 relative"; bm.className="flex-1 flex flex-col items-center justify-center p-2 rounded-xl text-amber-300"; }
    }

    async function api(u,m='GET',b=null){ try{const o={method:m,headers:{'Content-Type':'application/json'}};if(b)o.body=JSON.stringify(b);const r=await fetch(u,o);const d=await r.json();if(!r.ok)throw new Error(d.error);return d;}catch(e){return null;}}

    async function init(){
      const regs = await api('/api/registers');
      if(!registerId || !regs.find(r=>r.id===registerId)){
        qs("#registerModal").classList.remove("hidden");
        qs("#registerList").innerHTML=regs.map(r=>`<button onclick="selectRegister('${r.id}')" class="p-4 bg-white dark:bg-zinc-900 border-2 border-amber-100 dark:border-zinc-700 rounded-2xl hover:border-teal-400 text-left shadow-sm group transition-all"><div class="font-bold text-lg text-amber-900 dark:text-zinc-100 group-hover:text-teal-600 dark:group-hover:text-emerald-400">${r.name}</div></button>`).join('');
      } else {
        qs("#app").classList.remove("hidden");
        PRODUCTS = await api('/api/products') || [];
        await loadShift(); updateRecentHistory(); renderProducts(PRODUCTS);
        qs("#regBadge").textContent = regs.find(r=>r.id===registerId)?.name || registerId;
        qs("#cashInput").addEventListener('input', renderTicket);
        qs("#payBtn").onclick = payOrder;
        qs("#cancelBtn").onclick = ()=>{if(Object.keys(cart).length>0 && confirm("¿Borrar?")) cancelOrder()};
        qs("#closeShiftBtn").onclick = showCutModal;
      }
    }

    window.selectRegister=(id)=>{ localStorage.setItem('pos_register_id', id); location.reload(); }
    window.resetRegisterId=()=>{ if(confirm("¿Cambiar de caja?")) { localStorage.removeItem('pos_register_id'); location.reload(); } }
    
    async function loadShift(){
      currentShift = await api(`/api/shifts/current?register_id=${registerId}`);
      const d=qs("#shiftInfo");
      if(currentShift){ d.textContent=`CAJA ABIERTA`; d.className="text-[10px] font-bold mt-0.5 text-teal-200 uppercase tracking-wider"; }
      else { d.textContent="CAJA CERRADA"; d.className="text-[10px] font-bold mt-0.5 text-rose-200 uppercase tracking-wider"; }
    }

    window.addToCart=async(pid, delta=1)=>{
      if(!currentShift){ const i=prompt("Efectivo inicial:", "0"); if(i===null)return; await api('/api/shifts/open','POST',{register_id:registerId,opening_cash:i}); await loadShift(); }
      const newQty = (cart[pid]||0) + delta; if(newQty <= 0) delete cart[pid]; else cart[pid] = newQty;
      renderProducts(PRODUCTS); renderTicket();
      const badge = qs("#cartBadge"); const total = Object.values(cart).reduce((a,b)=>a+b,0);
      if(total>0){ badge.textContent=total; badge.classList.remove("hidden"); badge.classList.add("animate-bounce"); setTimeout(()=>badge.classList.remove("animate-bounce"),500); } else { badge.classList.add("hidden"); }
      if(!currentOrder && Object.keys(cart).length) { const r=await api('/api/orders','POST',{register_id:registerId}); if(r) currentOrder=r.order; }
      if(currentOrder) await api(`/api/orders/${currentOrder.id}/items`,'PUT',{items:Object.entries(cart).map(([p,q])=>({product_id:p,qty:q}))});
    }

    window.addPaseRapido=()=>{ const p=PRODUCTS.find(x=>x.name.toLowerCase().includes('pase')); if(p) addToCart(p.id, 1); }

    async function payOrder(){
      if(!currentOrder)return;
      qs("#payBtn").disabled=true; qs("#payBtn").textContent="Procesando...";
      const res=await api(`/api/orders/${currentOrder.id}/pay`,'POST',{cash_received:parseFloat(qs("#cashInput").value)||0});
      if(res?.ok){ qs("#bigChangeDisplay").textContent=money(res.change); qs("#changePanel").classList.remove("hidden"); qs("#changePanel").classList.add("flex"); updateRecentHistory(); } else { alert("Error"); renderTicket(); }
    }

    function resetOrder(){ cart={}; currentOrder=null; qs("#cashInput").value=""; qs("#changePanel").classList.add("hidden"); qs("#changePanel").classList.remove("flex"); qs("#payBtn").disabled=false; qs("#cartBadge").classList.add("hidden"); renderProducts(PRODUCTS); renderTicket(); switchTab('menu'); }
    async function cancelOrder(){ if(currentOrder) await api(`/api/orders/${currentOrder.id}/cancel`,'POST'); resetOrder(); }
    async function updateRecentHistory(){ const o=await api(`/api/orders/recent?register_id=${registerId}`); qs("#recentHistory").innerHTML=o?.map(x=>`<div class="flex justify-between items-center text-xs bg-amber-50 dark:bg-zinc-800 p-1.5 rounded-lg border border-amber-100 dark:border-zinc-700"><span class="text-amber-500 dark:text-zinc-400 font-mono">#${x.folio}</span><span class="text-teal-600 dark:text-emerald-400 font-bold">${money(x.total_cents)}</span></div>`).join('') || ''; }
    async function showCutModal(){ if(!currentShift)return alert("Cerrada"); const s=await api(`/api/shifts/${currentShift.id}/summary`); if(!s) return; qs("#cutOpening").textContent=money(s.shift.opening_cash_cents); qs("#cutSales").textContent=money(s.paid.cash_received-s.paid.change_sum); qs("#cutTotal").textContent=money(s.shift.opening_cash_cents+(s.paid.cash_received-s.paid.change_sum)); document.getElementById('cutModal').showModal(); }
    async function confirmCloseShift(){ if(currentShift) await api(`/api/shifts/${currentShift.id}/close`,'POST'); location.reload(); }

    function renderProducts(l){ qs("#productsGrid").innerHTML=l.map(p=>{ const q=cart[p.id]||0; const b=q>0?"border-teal-500 bg-teal-50 dark:bg-emerald-900/30 ring-2 ring-teal-500/20":"border-amber-200 dark:border-zinc-800 bg-white dark:bg-zinc-900 shadow-sm hover:border-teal-300"; return `<div onclick="addToCart('${p.id}', 1)" class="btn-pop cursor-pointer relative rounded-2xl border-2 ${b} p-3 flex flex-col justify-between h-28 transition-all"><div><div class="font-bold text-sm text-amber-900 dark:text-zinc-200 leading-tight">${p.name}</div><div class="text-[10px] text-amber-500 dark:text-zinc-500 mt-1 uppercase font-bold">${p.category}</div></div><div class="flex justify-between items-end"><span class="text-teal-600 dark:text-emerald-400 font-black text-lg">${money(p.price_cents)}</span>${q>0?`<div class="bg-yellow-400 dark:bg-emerald-500 text-amber-900 dark:text-zinc-950 font-black w-6 h-6 rounded-full flex items-center justify-center text-sm shadow-md border border-yellow-500 dark:border-emerald-600">${q}</div>`:''}</div></div>` }).join(''); }

    function renderTicket(){
       let sub=0; const html=Object.entries(cart).map(([id,q])=>{ const p=PRODUCTS.find(x=>x.id===id); if(!p) return ''; sub+=p.price_cents*q; return `<div class="flex justify-between items-center p-2 bg-amber-50 dark:bg-zinc-800 rounded-xl mb-2 border border-amber-100 dark:border-zinc-700"><div class="flex-1 min-w-0 pr-2"><div class="font-bold text-amber-900 dark:text-zinc-200 text-sm truncate">${p.name}</div><div class="text-xs text-teal-600 dark:text-emerald-400 font-mono font-bold">${money(p.price_cents*q)}</div></div><div class="flex items-center gap-1 bg-white dark:bg-zinc-900 rounded-lg p-1 border border-amber-200 dark:border-zinc-700 shadow-sm"><button onclick="addToCart('${id}', -1)" class="w-8 h-8 flex items-center justify-center rounded-md text-amber-400 dark:text-rose-400 hover:bg-rose-50 dark:hover:bg-rose-900/30 hover:text-rose-500 font-bold"><span class="material-icons-round text-base">remove</span></button><div class="font-bold text-amber-900 dark:text-white w-6 text-center text-sm">${q}</div><button onclick="addToCart('${id}', 1)" class="w-8 h-8 flex items-center justify-center rounded-md text-teal-600 dark:text-emerald-400 hover:bg-teal-50 dark:hover:bg-emerald-900/30 font-bold"><span class="material-icons-round text-base">add</span></button></div></div>` }).join('');
       qs("#ticketList").innerHTML = html || '<div class="flex flex-col items-center justify-center h-40 text-amber-300 dark:text-zinc-700 italic gap-2"><span class="material-icons-round text-4xl opacity-50">shopping_bag</span><span>Tu orden aquí</span></div>';
       qs("#totalDisplay").textContent=money(sub);
       const cash=parseFloat(qs("#cashInput").value)||0; const tot=sub/100; const opts=[tot,Math.ceil(tot/50)*50,100,200,500].filter(x=>x>=tot && x>0).sort((a,b)=>a-b).slice(0,4);
       qs("#smartCashButtons").innerHTML=[...new Set(opts)].map(v=>`<button onclick="qs('#cashInput').value=${v};renderTicket()" class="bg-white dark:bg-zinc-800 hover:bg-teal-50 dark:hover:bg-emerald-900/30 text-teal-700 dark:text-emerald-400 font-bold rounded-xl py-2 text-sm border-2 border-teal-100 dark:border-zinc-700 active:scale-95 transition-all shadow-sm">$${v}</button>`).join('');
       const btn=qs("#payBtn"); if(sub===0){ btn.disabled=true; btn.textContent="COBRAR"; btn.className="col-span-3 py-4 rounded-xl bg-gray-200 dark:bg-zinc-800 text-gray-400 dark:text-zinc-600 font-black text-2xl cursor-not-allowed"; } else if(cash<tot){ btn.disabled=true; btn.textContent=`Faltan $${(tot-cash).toFixed(2)}`; btn.className="col-span-3 py-4 rounded-xl bg-gray-100 dark:bg-zinc-800 border-2 border-rose-200 dark:border-rose-900 text-rose-400 font-bold text-xl cursor-not-allowed"; } else { btn.disabled=false; btn.innerHTML=`COBRAR <span class="text-lg opacity-80 font-normal ml-1">($${money(sub)})</span>`; btn.className="col-span-3 py-4 rounded-xl brand-btn-primary dark:bg-emerald-500 dark:text-zinc-950 font-black text-2xl shadow-lg btn-pop border-b-4 border-yellow-600 dark:border-emerald-700 active:border-b-0 active:translate-y-1 transition-all"; }
    }
    
    window.setCategory = (cat) => {
        currentCategory = cat;
        document.querySelectorAll('.cat-btn').forEach(b => { 
            if(b.textContent === cat) {
                b.className="cat-btn px-4 py-2 rounded-full bg-teal-600 dark:bg-emerald-500 text-white dark:text-zinc-950 font-bold text-xs whitespace-nowrap shadow-md transform scale-105";
            } else {
                b.className="cat-btn px-4 py-2 rounded-full bg-white dark:bg-zinc-800 border border-amber-200 dark:border-zinc-700 text-amber-900 dark:text-zinc-300 text-xs whitespace-nowrap font-bold hover:bg-amber-50 dark:hover:bg-zinc-700";
            }
        });
        filter();
    }

    window.filter = () => {
        const searchTerm = qs("#searchInput").value.toLowerCase();
        const filtered = PRODUCTS.filter(p => {
            const matchCat = currentCategory === 'Todo' ? true : (currentCategory === 'Comida' ? (p.category === 'Comida') : (currentCategory === 'Antojitos' ? (p.category === 'Antojitos') : p.category === currentCategory));
            const matchSearch = p.name.toLowerCase().includes(searchTerm);
            return matchCat && matchSearch;
        });
        renderProducts(filtered);
    }

    init();
  </script>
</body>
</html>